<script>
    $(document).ready(function () {

        //agregar fecha al formulario
        var fecha=new Date();
        var meses = new Array ("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
        $("#dia").html(fecha.getDate());
        $("#mes").html(meses[fecha.getMonth()]);
        $("#anio").html(fecha.getFullYear());
        var navListItems = $('div.setup-panel div button'),
            allWells = $('.setup-content'),
            allNextBtn = $('.nextBtn');

        allWells.hide();

        navListItems.click(function (e) {
            e.preventDefault();
            var $target = $($(this).attr('href')),
                $item = $(this);

            if (!$item.hasClass('disabled')) {
                navListItems.removeClass('btn-primary').addClass('btn-default');
                $item.addClass('btn-primary');
                allWells.hide();
                $target.show();
                $target.find('input:eq(0)').focus();
            }
        });

        allNextBtn.click(function(){
            var curStep = $(this).closest(".setup-content"),
                curStepBtn = curStep.attr("id"),
                nextStepWizard = $('div.setup-panel div button[href="#' + curStepBtn + '"]').parent().next().children("button"),
                curInputs = curStep.find("input[type='text'],input[type='url']"),
                isValid = true;
            $('body,html').animate({scrollTop : 400}, 500);

            $(".form-group").removeClass("has-error");
            for(var i=0; i<curInputs.length; i++){
                if (!curInputs[i].validity.valid){
                    isValid = false;
                    $(curInputs[i]).closest(".form-group").addClass("has-error");
                }
            }

            if (isValid)
                nextStepWizard.removeAttr('disabled').trigger('click');
        });

        $('div.setup-panel div button.btn-primary').trigger('click');
    });


    function comprobarConexion() {
        var conn=false;
        $.ajax({
            url: 'index.php',
            async: false,
            data: {'tag' : 'connection'}
        })
            .fail(function() { conn=false; })
            .done(function() { conn=true; })
        if(!conn){
            alert("Conexión a internet caida, vuelva intentarlo más tarde");
            event.preventDefault();
        }
    }


</script>
<div class="container banner">
	<section class="title-section">
		<h1 class="title-header">Agregar Plan De Accción</h1>
		<ul class="breadcrumb breadcrumb__t">
			<li><a href="index.php">Inicio</a></li>
			<li class="active">Agregar Plan De Accción</li>
		</ul>
	</section>
</div>
<div class='container contact'>

	<div id="titulo">
		<h2><strong>PLAN DE ACCION /PLAN DE MEJORA<strong></h2>
            <h4><strong>PROGRAMA DE FORTALECIMIENTO EMPRESARIAL<strong></h4></div><br>
                <hr>

           <div class="row">
					 <div class="col-md-12"><strong><br>ASESOR: </strong>{{ASESOR}}</div>
	<div class="col-md-12"><strong>FECHA:</strong> <span id="dia"></span>/<span id="mes">
                        </span>/<span id="anio"></span></div>
	<div class="col-md-12"> <br>
		<p class="sin-negrita">A pesar que no se conoce la fórmula exacta de éxito, el siguiente PLAN DE ACCION/PLAN DE MEJORA ayudará a su EMPRENDIEMIENTO
			o a su EMPRESA a aumentar los niveles de efectividad, eficiencia, productividad, competitividad y por consiguiente a crecer.
			Para iniciar, analice la situación actual de la empresa tomando del diagnóstico el resumen de aspectos a mejorar identificados,
			luego establezca objetivos, Plantee acciones de mejora y Proyecte el impacto deseado con el empresario/emprendedor, acuerde
			la ejecución del plan y haga seguimiento.
			<p>
				<br>
				<p class="sin-negrita"> <strong>*Nota:</strong> En caso de tener que intervenir más de un área, imprima nuevamente este formato.</p>
				<br>
				<p class="sin-negrita"><strong>AREA: </strong>{{Area}}</p>
				<br></div>
</div>

<hr>
<div class="container container-fixed">
	<div class="stepwizard">
		<div class="stepwizard-row setup-panel">
			<div class="stepwizard-step">
				<button href="#step-1" type="button" class="btn btn-primary btn-circle">1</button>
				<p>Paso 1</p>
			</div>
			<div class="stepwizard-step">
				<button href="#step-2" id="boton-soluciones2" type="button" class="btn btn-default btn-circle" disabled>2</button>
				<p>Paso 2</p>
			</div>
			<div class="stepwizard-step">
				<button href="#step-3" type="button" class="btn btn-default btn-circle" disabled>3</button>
				<p>Paso 3</p>
			</div>
			<div class="stepwizard-step">
				<button href="#step-4" type="button" class="btn btn-default btn-circle" disabled>4</button>
				<p>Paso 4</p>
			</div>
		</div>
	</div>
</div>
<hr>

<form role="form"  action="index.php" style="margin-right:50px">
	<input type="hidden" name="Asesor" value="{{ASESOR}}">
	<div class="row setup-content" id="step-1">
		<div class="col-xs-12">
			<div class="col-md-12">
				<h3 style="color:#579526">DEFINICIÓN DE PROBLEMAS</h3>
				<hr>
				<br>
				<div class="form-group">

					<!-- Primera tabla-->
					<div class="table-responsive">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>N°</th>
									<th>PROBLEMA</th>
									<th>CAUSA</th>
									<th>EFECTO SOBRE LA EMPRESA</th>
									<th>SOLUCIÓN</th>
								</tr>
							</thead>
							<tbody>
								<tr></tr>
								<tr>
									<th scope="row">1</th>
									<td><textarea class="textCuadrado" rows="3" name="" placeholder="Ingrese el problema"></textarea></td>
									<td><textarea class="textCuadrado" rows="3" name="" placeholder="Ingrese la causa"></textarea></td>
									<td><textarea class="textCuadrado" rows="3" name="" placeholder="Ingrese los efectos"></textarea></td>
									<td><textarea class="textCuadrado soluciones" rows="3" name="" placeholder="Ingrese la solución"></textarea></td>
									
								</tr>								
							</tbody>
						</table>
					</div>
					<div class="table-responsive">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>N°</th>
									<th>PROBLEMA</th>
									<th>CAUSA</th>
									<th>EFECTO SOBRE LA EMPRESA</th>
									<th>SOLUCIÓN</th>
								</tr>
							</thead>
							<tbody>
								<tr></tr>
								<tr>
									<th scope="row">1</th>
									<td><textarea class="textCuadrado" rows="3" name="" placeholder="Ingrese el problema"></textarea></td>
									<td><textarea class="textCuadrado" rows="3" name="" placeholder="Ingrese la causa"></textarea></td>
									<td><textarea class="textCuadrado" rows="3" name="" placeholder="Ingrese los efectos"></textarea></td>
									<td><textarea class="textCuadrado soluciones" rows="3" name="" placeholder="Ingrese la solución"></textarea></td>
									
								</tr>								
							</tbody>
						</table>
					</div>

				</div>

				<button  id="boton-soluciones" class="btn btn-primary nextBtn btn-lg pull-right" type="button">Guardar y continuar</button>
				<br><br><br>
			</div>
		</div>
	</div>

	<!-- -->
	<div class="row setup-content" id="step-2">
		<div class="col-xs-12">
			<div class="col-md-12">
				<h3 style="color:#579526">DEFINICIÓN DE OBJETIVOS</h3>
				<hr>
				<br>
				<div id="tablas-objetivos" class="form-group">
					<!-- Aqui van las tablas de los objetivos 
					que se insertaran de forma dinamica mediante javascript -->
					
				</div>
				<button class="btn btn-primary nextBtn btn-lg pull-right" type="button">Guardar y continuar</button>
				<br><br>
				<br>
			</div>
		</div>
	</div>
	<!-- -->

	<!-- -->
	<div class="row setup-content" id="step-3">
		<div class="col-xs-12">
			<div class="col-md-12">
				<h3 style="color:#579526">IMPACTO PROYECTADO EN SU EMPRESA</h3>
				<hr>
				<div class="form-group">
					<p class="sin-negrita">Con ayuda del Centro, se espera lograr los siguientes resultados: (aumento en #empleos creados, incremento %volumen
						en ventas, activos, rentabilidad, formalizado, acceso a crédito, etc.).</p><br>
					<!-- Cuarta tabla -->
					<div class="table-responsive">
							<div class="iconos-add-delete">
						<span>Añadir resultado </span><img id="agregar-resultados-plan-accion" src="./public/images/add.png"/>
						<span>&nbsp&nbsp&nbsp Eliminar resultado </span><img id="eliminar-resultados-plan-accion"src="./public/images/delete.png"/>
					</div>
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>N°</th>
									<th>RESULTADOS</th>
								</tr>
							</thead>
							<tbody id="resultados-plan-accion">
								<tr id="fila-resultados-1">
									<th scope="row">1</th>
									<td> <textarea class="textCuadrado" rows="3" name="resultados-plan-accion-1" placeholder="Ingrese los resultados"></textarea></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<button class="btn btn-primary nextBtn btn-lg pull-right" type="button">Guardar y continuar</button>
				<br><br>
				<br>
			</div>
		</div>
	</div>
	<!-- -->
	<div class="row setup-content" id="step-4">
		<div class="col-xs-12">
			<div class="col-md-12">
				<h3 style="color:#579526">VERIFICACÓN DE RESULTADOS OBTENIDOS</h3>
				<hr>
				<br>
				<div class="form-group">
					<label>Cumplió</label><br>
					<label>Si</label>
					<input type="radio" name="cumplio" value="si">
					<label>No</label>
					<input type="radio" name="cumplio" value="no" checked><br>
					<label>Se alcanzaron los objetivos propuestos?</label><br>
					<label>Si</label>
					<input type="radio" name="alcanzo" value="si">
					<label>No</label>
					<input type="radio" name="alcanzo" value="no" checked><br>
					<label>¿ Qué sucedió?</label><br>
					<textarea class="form-control" rows="3" name="productos/servicios" placeholder="Ingrese la información"></textarea><br>

					<div class="table-responsive">
						<table class="table table">
							<tr>
								<td><label>Cliente:</label></td>
								<td><label>Fecha:</label>
									<input type="date" class="form-control">
								</td>
							</tr>
							<tr>
								<td><label>Asesor:</label></td>
								<td><label>Fecha:</label>
									<input type="date" class="form-control">
								</td>
							</tr>
							<td><label>Coordinador/Director:</label></td>
							<td><label>Fecha:</label>
								<input type="date" class="form-control">
							</td>
						</table>
					</div>
					<br>
					<label>Observaciones adicionales:</label>
					<textarea class="form-control" rows="3" name="observaciones/adicionales" placeholder="Ingrese la información"></textarea><br>
				</div>
				<button onclick="comprobarConexion()" class="btn btn-primary btn-lg pull-right" type="submit">Guardar</button>
				<br><br>
				<br>

			</div>
		</div>
	</div>
</form>
</div>
</div>
<script>
 //array que guarda el numero de filas que tiene cada tabla de objetivos
 var array;
 var entro;
 var trTarea;
  //funcion para que se ejecute el script cuando termine de cargar el html
 $(document).ready(function () {
	 var trResultados=$("#resultados-plan-accion").html();
	 var contFilasResultados=1;
	 //agregar evento de clic al boton de guardar soluciones 
	 $("#boton-soluciones2").on("click",function(){ 
		var cont=0;
		$("#tablas-objetivos").empty();
		array=new Array();
		entro=false;
		//aqui recorro todos los textarea de la tabla problemas 
		// y por cada uno creo una tabla de objetivos 
		$(".textCuadrado.soluciones").each(function(){	
			//obtengo el valor del textarea
			var solucion=$(this).val();
			//obtengo la plantilla para agregar las tablas de objetivos 
			jQuery.get('./app/views/PlanAccion/tablas-objetivos.html', function(data) {
				cont++;
				//agrego el valor inicial de 1 fila en el array de las filas de los objetivos
				array.push(1);
				//reemplazo los valores en la plantilla que lei anteriormente con jQuery
				var tablas= data.replace(/{{OBJETIVO}}/gi,solucion);
				tablas= tablas.replace(/{{NUMERO_TAREA}}/gi,1);
				tablas= tablas.replace(/{{NUMERO_OBJETIVO}}/gi,cont);
				//agrego las tablas al div con id tablas-objetivos con la funcion append de jQuery
				$("#tablas-objetivos").append(tablas);

				//agrego el evento al icono de agregar tarea de cada una de las tablas de objetivos
				$("#"+cont+"-agregar-tarea").on("click", function(){
					//obtengo la id del icono agregar
					var id=$(this).attr("id");
					//obtengo el numero de la tabla objetivo asociado al icono 
					var num=parseInt(id.substring(0,id.indexOf("-")));
					//verifico que sea la primera vez que le clic para poder tomar la plantilla de la fila
					if(!entro){
					//obtengo el html de la fila de la tarea
					trTarea=$("#1-fila-tarea").html();
					entro=true;
					}
				//sumo +1 a la contador de la fila de la tabla a la que se le quiere añadir una fila
				array[num-1]=array[num-1]+1;
				//remplazo los valores en la platilla
				var html= trTarea.replace(/1/gi,array[num-1]);
				html= html.replace(/{{NUMERO_OBJETIVO}}/gi,num);
				//agrego la fila en la tabla objetivo numero n
				$("#"+num+"-fila-tarea").append(html);
			
									});
					//agrego el evento al icono de eliminar tarea de cada una de las tablas de objetivos
				$("#"+cont+"-eliminar-tarea").on("click", function(){
					//obtengo la id del icono elimar
					var id=$(this).attr("id");
					//obtengo el numero de la tabla objetivo asociado al icono 
					var num=parseInt(id.substring(0,id.indexOf("-")));
					//verifico que el numero de filas a borrar sean superior a 1
					if(array[num-1]>1){
					tbody=$("#"+num+"-fila-tarea tr:last-child").remove();
					array[num-1]=array[num-1]-1;

					}
									});
							});
				});
		
	 });

	 //agrego el evento al icono de agregar resultados de plan accion 
	$("#agregar-resultados-plan-accion").on("click", function(){
		  contFilasResultados++;
		  var html= trResultados.replace(/1/gi,contFilasResultados);
		  $("#resultados-plan-accion").append(html);
	 });
	  //eliminar el evento al icono de agregar resultados de plan accion 
	 $("#eliminar-resultados-plan-accion").on("click", function(){
		//verifico que el numero de filas a borrar sean superior a 1
		  if(contFilasResultados>1){
			  $("#fila-resultados-"+contFilasResultados).remove();  
			  contFilasResultados--;
		  }
	 });
  });
</script>